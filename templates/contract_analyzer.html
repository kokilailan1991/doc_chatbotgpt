{% extends "base.html" %}

{% block content %}
<div class="main-content-wrapper">
  <div class="tool-header">
    <h1 class="tool-title">üìú Contract Analyzer AI</h1>
    <p class="tool-subtitle">Professional contract analysis: obligations, risks, missing clauses, and legal insights. <strong style="color: #dc3545;">Informational only, not legal advice.</strong></p>
  </div>

  <button onclick="trySampleContract()" class="demo-btn-large">‚ú® Try Sample Contract</button>

  <div class="upload-card">
    <h3 class="upload-header">Upload Contract</h3>
    <form id="contractUploadForm" enctype="multipart/form-data">
      <label class="upload-label">Select Contract (PDF):</label>
      <input type="file" id="contractFile" accept=".pdf" class="file-input" />
      <button type="submit" class="upload-btn">Upload & Analyze</button>
    </form>
    
    <div class="sample-links">
      <a href="#" onclick="trySampleContract(); return false;">Try Sample Contract</a>
    </div>
  </div>

  <div id="contractStatus" class="status-message"></div>

  <div class="workflow-actions" id="contractActions" style="display: none;">
    <button onclick="analyzeContract()" class="workflow-btn">Analyze Contract</button>
    <button onclick="shareResult()" class="workflow-btn share">Share Result</button>
    <button onclick="copyResult()" class="workflow-btn copy">Copy Result</button>
  </div>

  <div id="contractResults" class="results-section"></div>
</div>

<script>
document.getElementById("contractUploadForm").addEventListener("submit", async (e) => {
  e.preventDefault();
  const file = document.getElementById("contractFile").files[0];
  if (!file) {
    document.getElementById("contractStatus").innerHTML = '<div class="error-message">Please select a PDF file</div>';
    return;
  }
  
  const formData = new FormData();
  formData.append("file", file);
  
  document.getElementById("contractStatus").innerHTML = '<div class="loading">‚è≥ Processing contract...</div>';
  
  try {
    const res = await fetch("/upload", { method: "POST", body: formData });
    
    if (!res.ok) {
      const errorData = await res.json().catch(() => ({ error: `HTTP ${res.status}: ${res.statusText}` }));
      document.getElementById("contractStatus").innerHTML = '<div class="error-message">‚ùå ' + (errorData.error || `Server error: ${res.status}`) + '</div>';
      return;
    }
    
    const data = await res.json();
    
    if (data.error) {
      document.getElementById("contractStatus").innerHTML = '<div class="error-message">‚ùå ' + data.error + '</div>';
    } else if (data.message) {
      document.getElementById("contractStatus").innerHTML = '<div class="success-message">‚úÖ ' + data.message + '</div>';
      document.getElementById("contractActions").style.display = "flex";
    } else {
      document.getElementById("contractStatus").innerHTML = '<div class="error-message">‚ùå Unexpected response format</div>';
    }
  } catch (error) {
    document.getElementById("contractStatus").innerHTML = '<div class="error-message">‚ùå Error: ' + error.message + '</div>';
  }
});

async function analyzeContract() {
  const resultsDiv = document.getElementById("contractResults");
  resultsDiv.innerHTML = '<div class="loading">‚è≥ Analyzing contract... This should take 15-30 seconds.</div>';
  
  // Disable button during analysis
  const analyzeBtn = document.querySelector('button[onclick="analyzeContract()"]');
  const originalText = analyzeBtn ? analyzeBtn.textContent : '';
  if (analyzeBtn) {
    analyzeBtn.disabled = true;
    analyzeBtn.textContent = '‚è≥ Analyzing...';
  }
  
  try {
    const startTime = Date.now();
    const res = await fetch("/api/contract/analyze", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({})
    });
    
    if (!res.ok) {
      const errorData = await res.json().catch(() => ({ error: `HTTP ${res.status}: ${res.statusText}` }));
      throw new Error(errorData.error || `Server error: ${res.status}`);
    }
    
    const data = await res.json();
    
    if (data.error) {
      document.getElementById("contractResults").innerHTML = '<div class="error-message">‚ùå ' + data.error + '</div>';
      return;
    }
    
    const elapsed = ((Date.now() - startTime) / 1000).toFixed(1);
    displayContractResults("contractResults", data);
    document.getElementById("contractResults").scrollIntoView({ behavior: 'smooth' });
    
    // Re-enable button
    if (analyzeBtn) {
      analyzeBtn.disabled = false;
      analyzeBtn.textContent = originalText;
    }
  } catch (error) {
    document.getElementById("contractResults").innerHTML = '<div class="error-message">‚ùå Error: ' + error.message + '</div>';
    
    // Re-enable button on error
    if (analyzeBtn) {
      analyzeBtn.disabled = false;
      analyzeBtn.textContent = originalText;
    }
  }
}

async function trySampleContract() {
  const sampleData = {
    summary: "This Service Agreement outlines the terms and conditions between Allluminator Technologies Pvt Ltd and Horizon Logistics Ltd for the development and deployment of an AI-powered document analysis tool. The scope of work includes the development of the tool, maintenance and support for 12 months, and the delivery of weekly progress reports. The Provider will deliver a fully functional AI tool by 30 March 2025, along with documentation and training sessions for the Client's staff. The total contract value is USD 25,000, with a payment schedule of 40% upfront, 40% upon delivery of the beta version, and 20% after final acceptance.",
    metadata: {
      parties: { provider: "Allluminator Technologies Pvt Ltd", client: "Horizon Logistics Ltd" },
      contractDate: "2025-01-15",
      effectiveDate: "2025-01-15",
      expirationDate: "2026-01-15",
      contractValue: "USD 25,000",
      contractType: "Service Agreement",
      governingLaw: "Singapore",
      disputeResolution: "Arbitration in Singapore"
    },
    providerObligations: [
      { title: "Deliver AI Tool", description: "Deliver fully functional AI tool by 30 March 2025", deadline: "2025-03-30" },
      { title: "Provide Documentation", description: "Deliver complete documentation and training sessions", deadline: "Upon delivery" },
      { title: "Maintenance & Support", description: "Provide maintenance and support for 12 months", deadline: "Ongoing" }
    ],
    clientObligations: [
      { title: "Make Payments", description: "Pay 40% upfront, 40% upon beta delivery, 20% after final acceptance", deadline: "As per schedule" },
      { title: "Provide Access", description: "Provide necessary access and information for tool development", deadline: "Ongoing" }
    ],
    risks: [
      { title: "Broad Liability Clause", description: "Liability clause may be too broad and expose provider to excessive risk", severity: "high", category: "legal", mitigation: "Add liability cap and exclusions for indirect damages" },
      { title: "Unclear Termination Notice", description: "Termination clause lacks clear notice period", severity: "medium", category: "legal", mitigation: "Specify minimum 30-day written notice requirement" },
      { title: "Payment Risk", description: "20% payment after final acceptance may be delayed if acceptance criteria are unclear", severity: "medium", category: "financial", mitigation: "Define clear acceptance criteria and timeline" }
    ],
    missingClauses: [
      { clauseName: "Force Majeure", importance: "important", description: "Protects both parties from events beyond their control", suggestedWording: "Neither party shall be liable for delays due to circumstances beyond reasonable control." },
      { clauseName: "IP Ownership Clarification", importance: "critical", description: "Need clear IP ownership terms for developed tool", suggestedWording: "All IP rights in the developed tool shall belong to [specify party]." }
    ],
    keyClauses: {
      payment: "Payment schedule: 40% upfront, 40% upon beta delivery, 20% after final acceptance. Total value: USD 25,000.",
      confidentiality: "Both parties agree to maintain confidentiality of proprietary information for the duration and 3 years after termination.",
      liability: "Provider warrants services will be performed with reasonable skill and care. Liability limitations apply.",
      termination: "Agreement valid for 12 months. Termination provisions included but notice period could be clearer.",
      ipOwnership: "IP ownership terms need clarification - specify who owns the developed tool and any modifications.",
      disputeResolution: "Disputes to be resolved through arbitration in Singapore, governed by Singapore law.",
      warranties: "Provider warrants services will be performed with reasonable skill and care.",
      indemnification: "Standard indemnification clauses present but scope may need clarification."
    },
    improvements: [
      { title: "Clarify Termination Notice Period", description: "Add specific 30-day written notice requirement for termination", priority: "high", suggestedWording: "Either party may terminate this agreement with 30 days written notice." },
      { title: "Add Liability Cap", description: "Limit liability to contract value or a specified amount", priority: "high", suggestedWording: "Total liability shall not exceed the contract value of USD 25,000." },
      { title: "Define Acceptance Criteria", description: "Clearly define what constitutes 'final acceptance' to avoid payment delays", priority: "medium", suggestedWording: "Final acceptance shall be deemed granted if Client does not provide written objections within 14 days of delivery." }
    ],
    overallRiskLevel: "medium"
  };
  displayContractResults("contractResults", sampleData);
  document.getElementById("contractStatus").innerHTML = '<div class="success-message">‚úÖ Sample contract loaded!</div>';
  document.getElementById("contractActions").style.display = "flex";
}

function displayContractResults(containerId, data) {
  const container = document.getElementById(containerId);
  
  // Check for errors first
  if (data.error) {
    container.innerHTML = '<div class="error-message">‚ùå ' + data.error + '</div>';
    return;
  }
  
  let html = '<div class="result-card fade-in"><h3 class="result-header">üìú International Contract Analysis</h3>';
  
  // Executive Summary
  if (data.executiveSummary && data.executiveSummary.length > 0) {
    html += '<div class="result-section summary-card"><h4>üìä Executive Summary:</h4><ul style="list-style: none; padding-left: 0;">';
    data.executiveSummary.forEach(point => {
      html += `<li style="margin: 0.75rem 0; padding-left: 1.5rem; position: relative;">`;
      html += `<span style="position: absolute; left: 0;">‚Ä¢</span> ${point}</li>`;
    });
    html += '</ul></div>';
  }
  
  // Parties and Contract Type
  if (data.partiesAndType) {
    const pt = data.partiesAndType;
    html += '<div class="result-section metadata-card"><h4>üë• Parties & Contract Type:</h4>';
    html += '<div class="metadata-grid">';
    if (pt.parties) {
      html += `<div class="metadata-item"><strong>Provider/Service Provider:</strong> ${pt.parties.provider || pt.parties.serviceProvider || 'Unknown'}</div>`;
      html += `<div class="metadata-item"><strong>Client/Customer:</strong> ${pt.parties.client || pt.parties.customer || 'Unknown'}</div>`;
    }
    if (pt.contractType) {
      html += `<div class="metadata-item"><strong>Contract Type:</strong> ${pt.contractType}</div>`;
    }
    if (pt.governingLaw) {
      html += `<div class="metadata-item"><strong>Governing Law:</strong> ${pt.governingLaw} <em>(as stated in contract)</em></div>`;
    } else {
      html += `<div class="metadata-item"><strong>Governing Law:</strong> <em>Not specified in contract</em></div>`;
    }
    if (pt.jurisdiction) {
      html += `<div class="metadata-item"><strong>Jurisdiction:</strong> ${pt.jurisdiction} <em>(as stated in contract)</em></div>`;
    }
    html += '</div></div>';
  }
  
  // Scope and Obligations
  if (data.scopeAndObligations) {
    const so = data.scopeAndObligations;
    html += '<div class="result-section"><h4>üìã Scope of Services / Obligations:</h4>';
    if (so.scopeOfServices) {
      html += `<div style="margin-bottom: 1.5rem;"><strong>Scope of Services:</strong><p style="margin-top: 0.5rem; line-height: 1.8;">${so.scopeOfServices}</p></div>`;
    }
    if (so.providerObligations && so.providerObligations.length > 0) {
      html += '<div class="obligations-card provider" style="margin-bottom: 1rem;"><h5>üë§ Provider Obligations:</h5><ul>';
      so.providerObligations.forEach(ob => {
        const title = ob.title || 'Obligation';
        const desc = ob.description || '';
        const deadline = ob.deadline ? ` <em>(Deadline: ${ob.deadline})</em>` : '';
        html += `<li><strong>${title}</strong>${desc ? ': ' + desc : ''}${deadline}</li>`;
      });
      html += '</ul></div>';
    }
    if (so.clientObligations && so.clientObligations.length > 0) {
      html += '<div class="obligations-card client"><h5>üë• Client Obligations:</h5><ul>';
      so.clientObligations.forEach(ob => {
        const title = ob.title || 'Obligation';
        const desc = ob.description || '';
        const deadline = ob.deadline ? ` <em>(Deadline: ${ob.deadline})</em>` : '';
        html += `<li><strong>${title}</strong>${desc ? ': ' + desc : ''}${deadline}</li>`;
      });
      html += '</ul></div>';
    }
    html += '</div>';
  }
  
  // Commercial Terms
  if (data.commercialTerms) {
    const ct = data.commercialTerms;
    html += '<div class="result-section" style="background: #f0fff4; border-left: 4px solid #28a745;"><h4>üí∞ Commercial Terms:</h4>';
    if (ct.pricing) html += `<div style="margin: 0.5rem 0;"><strong>Pricing:</strong> ${ct.pricing}</div>`;
    if (ct.paymentTerms) html += `<div style="margin: 0.5rem 0;"><strong>Payment Terms:</strong> ${ct.paymentTerms}</div>`;
    if (ct.currency) html += `<div style="margin: 0.5rem 0;"><strong>Currency:</strong> ${ct.currency}</div>`;
    if (ct.paymentMethod) html += `<div style="margin: 0.5rem 0;"><strong>Payment Method:</strong> ${ct.paymentMethod}</div>`;
    html += '</div>';
  }
  
  // Clause-by-Clause Analysis (Table Format)
  if (data.clauseAnalysis && data.clauseAnalysis.length > 0) {
    html += '<div class="result-section key-clauses-card"><h4>üìë Clause-by-Clause Analysis:</h4>';
    html += '<div style="overflow-x: auto;"><table class="clause-analysis-table" style="width: 100%; border-collapse: collapse; margin-top: 1rem;">';
    html += '<thead><tr style="background: #f5f5f5;">';
    html += '<th style="padding: 0.75rem; text-align: left; border: 1px solid #ddd;">Clause</th>';
    html += '<th style="padding: 0.75rem; text-align: left; border: 1px solid #ddd;">Presence</th>';
    html += '<th style="padding: 0.75rem; text-align: left; border: 1px solid #ddd;">Adequacy</th>';
    html += '<th style="padding: 0.75rem; text-align: left; border: 1px solid #ddd;">Balance</th>';
    html += '<th style="padding: 0.75rem; text-align: left; border: 1px solid #ddd;">Summary & Assessment</th>';
    html += '</tr></thead><tbody>';
    
    data.clauseAnalysis.forEach(clause => {
      const presence = clause.presence || 'unknown';
      const adequacy = clause.adequacy || 'unknown';
      const balance = clause.balance || 'unclear';
      
      const presenceColor = presence === 'present' ? '#4caf50' : presence === 'weak' ? '#ff9800' : '#f44336';
      const adequacyColor = adequacy === 'adequate' ? '#4caf50' : adequacy === 'weak' ? '#ff9800' : '#f44336';
      
      html += '<tr>';
      html += `<td style="padding: 0.75rem; border: 1px solid #ddd; font-weight: 600;">${clause.clauseName || 'Unknown'}</td>`;
      html += `<td style="padding: 0.75rem; border: 1px solid #ddd;"><span style="color: ${presenceColor}; font-weight: 600;">${presence.toUpperCase()}</span></td>`;
      html += `<td style="padding: 0.75rem; border: 1px solid #ddd;"><span style="color: ${adequacyColor}; font-weight: 600;">${adequacy.toUpperCase()}</span></td>`;
      html += `<td style="padding: 0.75rem; border: 1px solid #ddd;">${balance}</td>`;
      html += `<td style="padding: 0.75rem; border: 1px solid #ddd; line-height: 1.6;">`;
      if (clause.summary) html += `<strong>Summary:</strong> ${clause.summary}<br>`;
      if (clause.assessment) html += `<strong>Assessment:</strong> ${clause.assessment}`;
      html += '</td>';
      html += '</tr>';
    });
    
    html += '</tbody></table></div></div>';
  }
  
  // Risk Assessment
  if (data.riskAssessment && data.riskAssessment.length > 0) {
    html += '<div class="result-section risks-card"><h4>‚ö†Ô∏è Risk Assessment:</h4>';
    if (data.overallRiskLevel) {
      const riskLevel = data.overallRiskLevel.toUpperCase();
      const riskColor = riskLevel === 'HIGH' ? '#dc3545' : riskLevel === 'MEDIUM' ? '#ffc107' : '#28a745';
      html += `<div class="overall-risk"><strong>Overall Risk Level:</strong> <span style="color: ${riskColor}; font-weight: bold; font-size: 1.2rem;">${riskLevel}</span></div>`;
    }
    html += '<div style="margin-top: 1rem;">';
    data.riskAssessment.forEach(risk => {
      const riskLevel = (risk.riskLevel || 'LOW').toUpperCase();
      const riskColor = riskLevel === 'HIGH' ? '#dc3545' : riskLevel === 'MEDIUM' ? '#ffc107' : '#28a745';
      const category = risk.category || 'general';
      
      html += '<div style="margin: 1rem 0; padding: 1rem; background: white; border-radius: 8px; border-left: 4px solid ' + riskColor + ';">';
      html += `<strong style="font-size: 1.1rem;">${risk.title || 'Risk'}</strong> `;
      html += `<span class="severity-badge" style="background: ${riskColor === '#dc3545' ? '#ffebee' : riskColor === '#ffc107' ? '#fff8e1' : '#e8f5e9'}; color: ${riskColor}; border: 1px solid ${riskColor};">${riskLevel}</span> `;
      html += `<span class="category-badge">${category}</span>`;
      if (risk.affectedClause) {
        html += `<div style="margin-top: 0.5rem; color: #666;"><strong>Affected Clause:</strong> ${risk.affectedClause}</div>`;
      }
      if (risk.description) {
        html += `<div style="margin-top: 0.5rem; line-height: 1.6;"><strong>Why this risk exists:</strong> ${risk.description}</div>`;
      }
      if (risk.impact) {
        html += `<div style="margin-top: 0.5rem;"><strong>Impact:</strong> ${risk.impact}</div>`;
      }
      if (risk.recommendation) {
        html += `<div style="margin-top: 0.5rem; color: #6C5DD3;"><strong>üí° Recommendation:</strong> ${risk.recommendation}</div>`;
      }
      html += '</div>';
    });
    html += '</div></div>';
  }
  
  // Global Compliance Review
  if (data.globalCompliance) {
    const gc = data.globalCompliance;
    html += '<div class="result-section" style="background: #e3f2fd; border-left: 4px solid #2196F3;"><h4>üåç Global Compliance Review:</h4>';
    
    if (gc.internationalEnforceability) {
      html += `<div style="margin: 1rem 0; padding: 1rem; background: white; border-radius: 8px;"><strong>International Enforceability:</strong><p style="margin-top: 0.5rem; line-height: 1.6;">${gc.internationalEnforceability}</p></div>`;
    }
    
    if (gc.dataPrivacyGaps && gc.dataPrivacyGaps.length > 0) {
      html += '<div style="margin: 1rem 0;"><strong>Data Privacy Gaps:</strong><ul>';
      gc.dataPrivacyGaps.forEach(gap => html += `<li>${gap}</li>`);
      html += '</ul></div>';
    }
    
    if (gc.crossBorderIssues && gc.crossBorderIssues.length > 0) {
      html += '<div style="margin: 1rem 0;"><strong>Cross-Border Issues:</strong><ul>';
      gc.crossBorderIssues.forEach(issue => html += `<li>${issue}</li>`);
      html += '</ul></div>';
    }
    
    if (gc.complianceRecommendations && gc.complianceRecommendations.length > 0) {
      html += '<div style="margin: 1rem 0;"><strong>Compliance Recommendations:</strong><ul>';
      gc.complianceRecommendations.forEach(rec => html += `<li>${rec}</li>`);
      html += '</ul></div>';
    }
    
    html += '</div>';
  }
  
  // Optional Improvement Clauses
  if (data.optionalImprovements && data.optionalImprovements.length > 0) {
    html += '<div class="result-section improvements-card"><h4>üí° Optional Improvement Clauses:</h4>';
    html += '<div style="margin-bottom: 1rem; padding: 0.75rem; background: #fff3cd; border-left: 4px solid #ffc107; border-radius: 4px;">';
    html += '<strong>‚ö†Ô∏è Note:</strong> These are optional, jurisdiction-agnostic suggestions. They are not requirements and should be reviewed by legal counsel before implementation.';
    html += '</div>';
    html += '<ul>';
    data.optionalImprovements.forEach(imp => {
      const priority = (imp.priority || 'medium').toLowerCase();
      const priorityColor = priority === 'high' ? '#dc3545' : priority === 'medium' ? '#ffc107' : '#28a745';
      html += '<li style="margin: 1rem 0; padding: 1rem; background: white; border-radius: 8px; border-left: 3px solid ' + priorityColor + ';">';
      html += `<strong>${imp.title || 'Improvement'}</strong> `;
      html += `<span class="priority-badge priority-${priority}" style="background: ${priorityColor === '#dc3545' ? '#ffebee' : priorityColor === '#ffc107' ? '#fff8e1' : '#e8f5e9'}; color: ${priorityColor}; border: 1px solid ${priorityColor};">${priority.toUpperCase()}</span>`;
      if (imp.clauseName) {
        html += `<div style="margin-top: 0.5rem; color: #666;"><strong>Related Clause:</strong> ${imp.clauseName}</div>`;
      }
      if (imp.description) {
        html += `<div style="margin-top: 0.5rem; line-height: 1.6;">${imp.description}</div>`;
      }
      if (imp.suggestedWording) {
        html += `<div style="margin-top: 0.75rem; padding: 0.75rem; background: #f8f9fa; border-radius: 4px; font-family: 'Courier New', monospace; font-size: 0.9rem; line-height: 1.6;">`;
        html += `<strong>Suggested Wording:</strong><br>${imp.suggestedWording}`;
        html += '</div>';
      }
      if (imp.note) {
        html += `<div style="margin-top: 0.5rem; font-style: italic; color: #666;">${imp.note}</div>`;
      }
      html += '</li>';
    });
    html += '</ul></div>';
  }
  
  html += '<details class="result-section"><summary>View Full JSON</summary><pre class="result-json">' + JSON.stringify(data, null, 2) + '</pre></details>';
  html += '<button onclick="copyResult()" class="copy-btn">üìã Copy Result</button></div>';
  
  container.innerHTML = html;
}

function shareResult() {
  const shareUrl = window.location.href;
  if (navigator.share) {
    navigator.share({ title: "Contract Analysis", url: shareUrl });
  } else {
    navigator.clipboard.writeText(shareUrl);
    alert("Link copied to clipboard!");
  }
}

function copyResult() {
  const results = document.querySelectorAll('.result-card pre');
  if (results.length > 0) {
    navigator.clipboard.writeText(results[0].innerText);
    alert("Results copied to clipboard!");
  }
}
</script>

<style>
/* Contract-specific styles */
.metadata-card {
  background: linear-gradient(135deg, #E3F2FD 0%, #E8F5E9 100%);
  border-left: 4px solid #2196F3;
}

.metadata-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 1rem;
  margin-top: 1rem;
}

.metadata-item {
  padding: 0.75rem;
  background: white;
  border-radius: 8px;
  border: 1px solid #e0e0e0;
}

.summary-card {
  background: linear-gradient(135deg, #F3E5F5 0%, #E1BEE7 100%);
  border-left: 4px solid #9C27B0;
}

.obligations-card {
  border-left: 4px solid #4CAF50;
}

.obligations-card.provider {
  background: linear-gradient(135deg, #E8F5E9 0%, #C8E6C9 100%);
}

.obligations-card.client {
  background: linear-gradient(135deg, #E1F5FE 0%, #B3E5FC 100%);
}

.risks-card {
  background: linear-gradient(135deg, #FFEBEE 0%, #FFCDD2 100%);
  border-left: 4px solid #F44336;
}

.overall-risk {
  padding: 1rem;
  background: white;
  border-radius: 8px;
  margin-bottom: 1rem;
  font-size: 1.1rem;
}

.missing-clauses-card {
  background: linear-gradient(135deg, #FFF3E0 0%, #FFE0B2 100%);
  border-left: 4px solid #FF9800;
}

.key-clauses-card {
  background: linear-gradient(135deg, #E0F2F1 0%, #B2DFDB 100%);
  border-left: 4px solid #009688;
}

.key-clauses-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: 1rem;
  margin-top: 1rem;
}

.key-clause-item {
  padding: 1rem;
  background: white;
  border-radius: 8px;
  border: 1px solid #e0e0e0;
  line-height: 1.6;
}

.improvements-card {
  background: linear-gradient(135deg, #E8F5E9 0%, #C8E6C9 100%);
  border-left: 4px solid #4CAF50;
}

.severity-badge {
  display: inline-block;
  padding: 3px 10px;
  border-radius: 12px;
  font-size: 0.75rem;
  font-weight: 600;
  margin-left: 0.5rem;
}

.severity-high {
  background: #ffebee;
  color: #c62828;
  border: 1px solid #c62828;
}

.severity-medium {
  background: #fff8e1;
  color: #f57c00;
  border: 1px solid #f57c00;
}

.severity-low {
  background: #e8f5e9;
  color: #2e7d32;
  border: 1px solid #2e7d32;
}

.category-badge {
  display: inline-block;
  padding: 3px 8px;
  border-radius: 8px;
  font-size: 0.7rem;
  background: #e0e0e0;
  color: #424242;
  margin-left: 0.5rem;
}

.importance-badge {
  display: inline-block;
  padding: 3px 10px;
  border-radius: 12px;
  font-size: 0.75rem;
  font-weight: 600;
  margin-left: 0.5rem;
}

.importance-critical {
  background: #ffebee;
  color: #c62828;
  border: 1px solid #c62828;
}

.importance-important {
  background: #fff8e1;
  color: #f57c00;
  border: 1px solid #f57c00;
}

.importance-recommended {
  background: #e8f5e9;
  color: #2e7d32;
  border: 1px solid #2e7d32;
}

.clause-analysis-table {
  font-size: 0.9rem;
}

.clause-analysis-table th {
  font-weight: 700;
  background: #f5f5f5;
}

.clause-analysis-table td {
  vertical-align: top;
}

.priority-badge {
  display: inline-block;
  padding: 3px 10px;
  border-radius: 12px;
  font-size: 0.75rem;
  font-weight: 600;
  margin-left: 0.5rem;
}

.priority-high {
  background: #ffebee;
  color: #c62828;
  border: 1px solid #c62828;
}

.priority-medium {
  background: #fff8e1;
  color: #f57c00;
  border: 1px solid #f57c00;
}

.priority-low {
  background: #e8f5e9;
  color: #2e7d32;
  border: 1px solid #2e7d32;
}

.result-section ul li {
  margin: 0.75rem 0;
  line-height: 1.7;
}

.result-section ul li strong {
  color: #333;
}

@media (max-width: 768px) {
  .metadata-grid,
  .key-clauses-grid {
    grid-template-columns: 1fr;
  }
}
</style>
{% endblock %}
