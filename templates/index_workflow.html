{% extends "base.html" %}

{% block content %}
<!-- Hero Section -->
<section class="hero-section">
  <div class="hero-container">
    <h1 class="hero-headline">Your AI Document Analyst</h1>
    <p class="hero-subheadline">Analyze resumes, invoices, contracts, EDI files, and websites with instant AI insights. Free. No login needed.</p>
    <div class="hero-ctas">
      <a href="#resume-tab" onclick="switchTab('resume'); return false;" class="hero-btn hero-btn-primary">Try Resume Analyzer</a>
      <a href="#edi-tab" onclick="switchTab('edi'); return false;" class="hero-btn hero-btn-secondary">Try Logistics EDI Validator</a>
    </div>
  </div>
</section>

<!-- Feature Grid -->
<section class="features-section">
  <div class="features-container">
    <!-- PDF Summary AI -->
    <div class="feature-card" onclick="window.location.href='/pdf-summary'">
      <div class="feature-icon">üìÑ</div>
      <h3 class="feature-title">PDF Summary AI</h3>
      <ul class="feature-list">
        <li>Summarize long PDFs</li>
        <li>Extract key insights</li>
        <li>Highlight important sections</li>
      </ul>
      <button class="feature-btn">Try Now ‚Üí</button>
    </div>
    
    <!-- Invoice Reader -->
    <div class="feature-card" onclick="window.location.href='/invoice-reader'">
      <div class="feature-icon">üßæ</div>
      <h3 class="feature-title">Invoice Reader</h3>
      <ul class="feature-list">
        <li>Auto-extract items & prices</li>
        <li>CSV export</li>
        <li>Suspicious charge detection</li>
      </ul>
      <button class="feature-btn">Try Now ‚Üí</button>
    </div>
    
    <!-- Contract Analyzer -->
    <div class="feature-card" onclick="window.location.href='/contract-analyzer'">
      <div class="feature-icon">üìë</div>
      <h3 class="feature-title">Contract Analyzer</h3>
      <ul class="feature-list">
        <li>Clause breakdown</li>
        <li>Risk & obligation detection</li>
        <li>Missing clause identification</li>
      </ul>
      <button class="feature-btn">Try Now ‚Üí</button>
    </div>
    
    <!-- Salary Slip Analyzer -->
    <div class="feature-card" onclick="window.location.href='/salary-slip'">
      <div class="feature-icon">üí∞</div>
      <h3 class="feature-title">Salary Slip Analyzer</h3>
      <ul class="feature-list">
        <li>Extract earnings & deductions</li>
        <li>Payroll validation</li>
        <li>Variance & anomalies</li>
      </ul>
      <button class="feature-btn">Try Now ‚Üí</button>
    </div>
    
    <!-- Resume Analyzer -->
    <div class="feature-card" onclick="switchTab('resume'); setTimeout(() => document.getElementById('resume-tab').scrollIntoView({behavior: 'smooth'}), 100);">
      <div class="feature-icon">üìÑ</div>
      <h3 class="feature-title">Resume Analyzer</h3>
      <ul class="feature-list">
        <li>ATS Score (0-100)</li>
        <li>JD Match Analysis</li>
        <li>Grammar & Clarity Fixes</li>
      </ul>
      <button class="feature-btn">Try Now ‚Üí</button>
    </div>
    
    <!-- Website Summary -->
    <div class="feature-card" onclick="window.location.href='/website-summary'">
      <div class="feature-icon">üåê</div>
      <h3 class="feature-title">Website Summary</h3>
      <ul class="feature-list">
        <li>Fetch webpage text</li>
        <li>Generate structured summary</li>
        <li>Extract key content automatically</li>
      </ul>
      <button class="feature-btn">Try Now ‚Üí</button>
    </div>
    
    <!-- Business Docs -->
    <div class="feature-card" onclick="window.location.href='/business-docs-ai'">
      <div class="feature-icon">üìä</div>
      <h3 class="feature-title">Business Docs</h3>
      <ul class="feature-list">
        <li>Invoice Analysis</li>
        <li>Contract Review</li>
        <li>Risk Detection</li>
      </ul>
      <button class="feature-btn">Try Now ‚Üí</button>
    </div>
    
    <!-- EDI Validator -->
    <div class="feature-card" onclick="switchTab('edi'); setTimeout(() => document.getElementById('edi-tab').scrollIntoView({behavior: 'smooth'}), 100);">
      <div class="feature-icon">üö¢</div>
      <h3 class="feature-title">EDI Validator</h3>
      <ul class="feature-list">
        <li>BAPLIE Validation</li>
        <li>Error Detection</li>
        <li>Container Analysis</li>
      </ul>
      <button class="feature-btn">Try Now ‚Üí</button>
    </div>
    
    <!-- Website Analyzer -->
    <div class="feature-card" onclick="window.location.href='/website-analyzer'">
      <div class="feature-icon">üîç</div>
      <h3 class="feature-title">Website Analyzer</h3>
      <ul class="feature-list">
        <li>SEO Score</li>
        <li>Content Analysis</li>
        <li>Keyword Extraction</li>
      </ul>
      <button class="feature-btn">Try Now ‚Üí</button>
    </div>
  </div>
</section>

<!-- Main Content Container - Only show when tab is clicked -->
<div class="main-content-wrapper" id="toolSection" style="display: none;">
  <!-- Tabs Section -->
  <div class="tabs-wrapper">
    <div class="tabs">
      <button class="tab-btn active" onclick="switchTab('resume')">
        <span class="tab-icon">üìÑ</span>
        <span>Resume</span>
      </button>
      <button class="tab-btn" onclick="switchTab('business')">
        <span class="tab-icon">üìä</span>
        <span>Business Docs</span>
      </button>
      <button class="tab-btn" onclick="switchTab('edi')">
        <span class="tab-icon">üö¢</span>
        <span>Logistics EDI</span>
      </button>
      <button class="tab-btn" onclick="switchTab('website')">
        <span class="tab-icon">üåê</span>
        <span>Website Analyzer</span>
      </button>
    </div>
  </div>

  <!-- Resume Tab -->
  <div id="resume-tab" class="tab-content active">
    <h2 class="tab-title">üìÑ Resume Analyzer</h2>
    <p class="tab-description">Upload your resume to get ATS score, match with job descriptions, and get AI-powered improvements.</p>
    
    <button onclick="tryDemoResume()" class="demo-btn-large">‚ú® Try Example Resume</button>
    
    <div class="upload-card">
      <h3 class="upload-header">Upload Document</h3>
      <form id="resumeUploadForm" enctype="multipart/form-data">
        <label class="upload-label">Upload Resume:</label>
        <input type="file" id="resumeFile" accept=".pdf" class="file-input" />
        <button type="submit" class="upload-btn">Upload Resume</button>
      </form>
      
      <form id="jdUploadForm" enctype="multipart/form-data" class="upload-form-secondary">
        <label class="upload-label">Upload Job Description (Optional):</label>
        <input type="file" id="jdFile" accept=".pdf" class="file-input" />
        <button type="submit" class="upload-btn">Upload JD</button>
      </form>
      
      <div class="sample-links">
        <a href="#" onclick="tryDemoResume(); return false;">Try Sample Resume</a>
      </div>
    </div>

    <div id="resumeStatus" class="status-message"></div>

    <div class="workflow-actions" id="resumeActions" style="display: none;">
      <button onclick="getATSScore()" class="workflow-btn">Get ATS Score</button>
      <button onclick="matchWithJD()" class="workflow-btn">Match with JD</button>
      <button onclick="getFullReport()" class="workflow-btn">Full Report</button>
      <button onclick="rewriteResume()" class="workflow-btn">Rewrite Resume</button>
      <button onclick="shareResult()" class="workflow-btn share">Share Result</button>
      <button onclick="copyResult()" class="workflow-btn copy">Copy Result</button>
    </div>

    <div id="resumeResults" class="results-section"></div>
  </div>

  <!-- Business Docs Tab -->
  <div id="business-tab" class="tab-content">
    <h2 class="tab-title">üìä Business Documents</h2>
    <p class="tab-description">Analyze contracts, invoices, and business documents with AI workflows.</p>
    
    <button onclick="tryDemoBusiness()" class="demo-btn-large">‚ú® Analyze Sample Invoice</button>
    
    <div class="upload-card">
      <h3 class="upload-header">Upload Document</h3>
      <form id="businessUploadForm" enctype="multipart/form-data">
        <label class="upload-label">Upload Document:</label>
        <input type="file" id="businessFile" accept=".pdf" class="file-input" />
        <button type="submit" class="upload-btn">Upload</button>
      </form>
    </div>

    <div id="businessStatus" class="status-message"></div>

    <div class="workflow-actions" id="businessActions" style="display: none;">
      <button onclick="extractInsights()" class="workflow-btn">Extract Insights</button>
      <button onclick="generateActionItems()" class="workflow-btn">Action Items</button>
      <button onclick="createSummary()" class="workflow-btn">Create Summary</button>
      <button onclick="riskAnalysis()" class="workflow-btn">Risk Analysis</button>
      <button onclick="generateEmail()" class="workflow-btn">Email Draft</button>
      <button onclick="shareResult()" class="workflow-btn share">Share Result</button>
    </div>

    <div class="output-format-selector">
      <label>Export Format:</label>
      <select id="outputFormat">
        <option value="json">JSON</option>
        <option value="excel">Excel/CSV</option>
        <option value="email">Email</option>
        <option value="slack">Slack</option>
        <option value="teams">Teams</option>
      </select>
      <button onclick="exportData()" class="export-btn">Export</button>
    </div>

    <div id="businessResults" class="results-section"></div>
  </div>

  <!-- EDI Tab -->
  <div id="edi-tab" class="tab-content">
    <h2 class="tab-title">üö¢ Logistics EDI Analyzer</h2>
    <p class="tab-description">Validate and analyze EDI documents (BAPLIE, MOVINS, COPRAR).</p>
    
    <button onclick="tryDemoEDI()" class="demo-btn-large">‚ú® Try Sample BAPLIE</button>
    
    <div class="upload-card">
      <h3 class="upload-header">Upload EDI Document</h3>
      <form id="ediUploadForm" enctype="multipart/form-data">
        <label class="upload-label">Upload EDI Document:</label>
        <input type="file" id="ediFile" accept=".edi,.txt,.baplie,.movins,.coprar" class="file-input" />
        <button type="submit" class="upload-btn">Upload & Analyze</button>
      </form>
      
      <div class="sample-links">
        <a href="#" onclick="tryDemoEDI(); return false;">Try Sample BAPLIE</a>
      </div>
    </div>

    <div id="ediStatus" class="status-message"></div>
    <div id="ediResults" class="results-section"></div>
  </div>

  <!-- Website Tab -->
  <div id="website-tab" class="tab-content">
    <h2 class="tab-title">üåê Website Analyzer</h2>
    <p class="tab-description">Analyze website content and extract insights.</p>
    
    <button onclick="tryDemoWebsite()" class="demo-btn-large">‚ú® Analyze aigpt.co.in</button>
    
    <div class="upload-card">
      <h3 class="upload-header">Enter Website URL</h3>
      <form id="urlForm">
        <label class="upload-label">Enter Website URL:</label>
        <input type="url" id="urlInput" placeholder="https://example.com" class="url-input" />
        <button type="submit" class="upload-btn">Analyze Website</button>
      </form>
    </div>

    <div id="websiteStatus" class="status-message"></div>

    <div class="workflow-actions" id="websiteActions" style="display: none;">
      <button onclick="extractInsights()" class="workflow-btn">Extract Insights</button>
      <button onclick="createSummary()" class="workflow-btn">Create Summary</button>
      <button onclick="shareResult()" class="workflow-btn share">Share Result</button>
    </div>

    <div id="websiteResults" class="results-section"></div>
  </div>
</div>

<script>
let currentFileId = "active";
let currentTab = "resume";

function switchTab(tabName) {
  // Show tool section if hidden
  const toolSection = document.getElementById('toolSection');
  if (toolSection) {
    toolSection.style.display = 'block';
  }
  
  // Hide all tabs
  document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
  document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
  
  // Show selected tab
  const targetTab = document.getElementById(tabName + '-tab');
  if (targetTab) {
    targetTab.classList.add('active');
  }
  
  // Update active button
  const buttons = document.querySelectorAll('.tab-btn');
  buttons.forEach(btn => {
    const btnText = btn.textContent.toLowerCase();
    if ((tabName === 'resume' && btnText.includes('resume')) ||
        (tabName === 'business' && btnText.includes('business')) ||
        (tabName === 'edi' && btnText.includes('edi')) ||
        (tabName === 'website' && btnText.includes('website'))) {
      btn.classList.add('active');
    }
  });
  
  currentTab = tabName;
  
  // Scroll to tab content
  setTimeout(() => {
    toolSection?.scrollIntoView({ behavior: 'smooth', block: 'start' });
  }, 100);
}

// Resume Analyzer Functions
document.getElementById("resumeUploadForm").addEventListener("submit", async (e) => {
  e.preventDefault();
  const formData = new FormData();
  formData.append("file", document.getElementById("resumeFile").files[0]);
  formData.append("file_id", "active");
  
  const res = await fetch("/api/upload-multi", { method: "POST", body: formData });
  const data = await res.json();
  document.getElementById("resumeStatus").innerHTML = data.message ? `<div class="success-message">‚úÖ ${data.message}</div>` : `<div class="error-message">‚ùå ${data.error}</div>`;
  if (data.message) document.getElementById("resumeActions").style.display = "flex";
});

document.getElementById("jdUploadForm").addEventListener("submit", async (e) => {
  e.preventDefault();
  const formData = new FormData();
  formData.append("file", document.getElementById("jdFile").files[0]);
  formData.append("file_id", "jd");
  
  const res = await fetch("/api/upload-multi", { method: "POST", body: formData });
  const data = await res.json();
  const currentStatus = document.getElementById("resumeStatus").innerHTML;
  document.getElementById("resumeStatus").innerHTML = currentStatus + (data.message ? `<div class="success-message">‚úÖ ${data.message}</div>` : `<div class="error-message">‚ùå ${data.error}</div>`);
});

async function getATSScore() {
  document.getElementById("resumeResults").innerHTML = '<div class="loading">‚è≥ Calculating ATS Score...</div>';
  try {
    const res = await fetch("/api/resume/ats-score", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({})
    });
    const data = await res.json();
    displayResumeResults("resumeResults", data, "ats");
    document.getElementById("resumeResults").scrollIntoView({ behavior: 'smooth', block: 'start' });
  } catch (error) {
    document.getElementById("resumeResults").innerHTML = `<div class="error-message">‚ùå Error: ${error.message}</div>`;
  }
}

async function matchWithJD() {
  const res = await fetch("/api/resume/match-jd", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ jd_file_id: "jd" })
  });
  const data = await res.json();
  displayResults("resumeResults", data);
}

async function getFullReport() {
  document.getElementById("resumeResults").innerHTML = '<div class="loading">‚è≥ Generating full report...</div>';
  try {
    const res = await fetch("/api/resume/full-report", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ jd_file_id: "jd" })
    });
    const data = await res.json();
    displayResumeResults("resumeResults", data, "full");
    document.getElementById("resumeResults").scrollIntoView({ behavior: 'smooth', block: 'start' });
  } catch (error) {
    document.getElementById("resumeResults").innerHTML = `<div class="error-message">‚ùå Error: ${error.message}</div>`;
  }
}

async function rewriteResume() {
  const res = await fetch("/api/resume/rewrite", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ improvements: [] })
  });
  const data = await res.json();
  displayResults("resumeResults", data);
}

// Business Docs Functions
document.getElementById("businessUploadForm").addEventListener("submit", async (e) => {
  e.preventDefault();
  const formData = new FormData();
  formData.append("file", document.getElementById("businessFile").files[0]);
  
  const res = await fetch("/upload", { method: "POST", body: formData });
  const data = await res.json();
  document.getElementById("businessStatus").innerHTML = data.message ? `<div class="success-message">‚úÖ ${data.message}</div>` : `<div class="error-message">‚ùå ${data.error}</div>`;
  if (data.message) document.getElementById("businessActions").style.display = "flex";
});

async function extractInsights() {
  document.getElementById("businessResults").innerHTML = '<div class="loading">‚è≥ Extracting insights...</div>';
  try {
    const res = await fetch("/api/workflow/extract-insights", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ document_type: "business" })
    });
    const data = await res.json();
    displayBusinessResults("businessResults", data);
    document.getElementById("businessResults").scrollIntoView({ behavior: 'smooth', block: 'start' });
  } catch (error) {
    document.getElementById("businessResults").innerHTML = `<div class="error-message">‚ùå Error: ${error.message}</div>`;
  }
}

async function generateActionItems() {
  const res = await fetch("/api/workflow/action-items", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({})
  });
  const data = await res.json();
  displayResults("businessResults", data);
}

async function createSummary() {
  const res = await fetch("/api/workflow/summary", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ type: "executive" })
  });
  const data = await res.json();
  displayResults("businessResults", data);
}

async function riskAnalysis() {
  const res = await fetch("/api/workflow/risk-analysis", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({})
  });
  const data = await res.json();
  displayResults("businessResults", data);
}

async function generateEmail() {
  const res = await fetch("/api/workflow/email-draft", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ type: "summary" })
  });
  const data = await res.json();
  displayResults("businessResults", data);
}

// EDI Functions
document.getElementById("ediUploadForm").addEventListener("submit", async (e) => {
  e.preventDefault();
  const file = document.getElementById("ediFile").files[0];
  if (!file) {
    document.getElementById("ediStatus").innerHTML = '<div class="error-message">Please select a file</div>';
    return;
  }
  
  const formData = new FormData();
  formData.append("file", file);
  
  document.getElementById("ediStatus").innerHTML = '<div class="loading">‚è≥ Analyzing EDI file...</div>';
  document.getElementById("ediResults").innerHTML = "";
  
  try {
    const res = await fetch("/api/analyze-edi", {
      method: "POST",
      body: formData
    });
    const data = await res.json();
    
    if (data.error) {
      document.getElementById("ediStatus").innerHTML = `<div class="error-message">‚ùå ${data.error}</div>`;
    } else {
      document.getElementById("ediStatus").innerHTML = '<div class="success-message">‚úÖ EDI file analyzed successfully!</div>';
      displayEDIResults("ediResults", data);
      document.getElementById("ediResults").scrollIntoView({ behavior: 'smooth', block: 'start' });
    }
  } catch (error) {
    document.getElementById("ediStatus").innerHTML = `<div class="error-message">‚ùå Error: ${error.message}</div>`;
  }
});

// Website Functions
document.getElementById("urlForm").addEventListener("submit", async (e) => {
  e.preventDefault();
  const url = document.getElementById("urlInput").value;
  if (!url) {
    document.getElementById("websiteStatus").innerHTML = '<div class="error-message">Please enter a URL</div>';
    return;
  }
  
  document.getElementById("websiteStatus").innerHTML = '<div class="loading">‚è≥ Analyzing website...</div>';
  document.getElementById("websiteResults").innerHTML = "";
  
  try {
    const res = await fetch("/api/analyze-website", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ url })
    });
    const data = await res.json();
    
    if (data.error) {
      document.getElementById("websiteStatus").innerHTML = `<div class="error-message">‚ùå ${data.error}</div>`;
    } else {
      document.getElementById("websiteStatus").innerHTML = '<div class="success-message">‚úÖ Website analyzed successfully!</div>';
      document.getElementById("websiteActions").style.display = "flex";
      displayWebsiteResults("websiteResults", data);
      document.getElementById("websiteResults").scrollIntoView({ behavior: 'smooth', block: 'start' });
    }
  } catch (error) {
    document.getElementById("websiteStatus").innerHTML = `<div class="error-message">‚ùå Error: ${error.message}</div>`;
  }
});

// Demo Functions
async function tryDemoResume() {
  document.getElementById("resumeResults").innerHTML = '<div class="loading">‚è≥ Loading demo resume analysis...</div>';
  try {
    const res = await fetch("/api/demo/resume");
    const data = await res.json();
    displayResumeResults("resumeResults", data, "ats");
    document.getElementById("resumeResults").scrollIntoView({ behavior: 'smooth', block: 'start' });
  } catch (error) {
    document.getElementById("resumeResults").innerHTML = `<div class="error-message">‚ùå Error: ${error.message}</div>`;
  }
}

async function tryDemoBusiness() {
  const res = await fetch("/api/demo/business");
  const data = await res.json();
  displayResults("businessResults", data.sampleData);
}

async function tryDemoEDI() {
  document.getElementById("ediStatus").innerHTML = '<div class="loading">‚è≥ Loading demo EDI analysis...</div>';
  document.getElementById("ediResults").innerHTML = "";
  try {
    const res = await fetch("/api/demo/edi");
    const data = await res.json();
    displayEDIResults("ediResults", data);
    document.getElementById("ediStatus").innerHTML = '<div class="success-message">‚úÖ Demo EDI analysis loaded!</div>';
    document.getElementById("ediResults").scrollIntoView({ behavior: 'smooth', block: 'start' });
  } catch (error) {
    document.getElementById("ediStatus").innerHTML = `<div class="error-message">‚ùå Error: ${error.message}</div>`;
  }
}

async function tryDemoWebsite() {
  const url = "https://aigpt.co.in";
  document.getElementById("websiteStatus").innerHTML = '<div class="loading">‚è≥ Analyzing demo website...</div>';
  document.getElementById("websiteResults").innerHTML = "";
  
  try {
    const res = await fetch("/api/analyze-website", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ url })
    });
    const data = await res.json();
    
    if (data.error) {
      document.getElementById("websiteStatus").innerHTML = `<div class="error-message">‚ùå ${data.error}</div>`;
    } else {
      document.getElementById("websiteStatus").innerHTML = '<div class="success-message">‚úÖ Demo analysis complete!</div>';
      document.getElementById("websiteActions").style.display = "flex";
      displayWebsiteResults("websiteResults", data);
    }
  } catch (error) {
    document.getElementById("websiteStatus").innerHTML = `<div class="error-message">‚ùå Error: ${error.message}</div>`;
  }
}

// Share Functions
function shareResult() {
  const shareUrl = window.location.href;
  if (navigator.share) {
    navigator.share({ title: "AI Document Analysis", url: shareUrl });
  } else {
    navigator.clipboard.writeText(shareUrl);
    alert("Link copied to clipboard!");
  }
}

function copyResult() {
  const results = document.querySelectorAll('.result-card pre');
  if (results.length > 0) {
    navigator.clipboard.writeText(results[0].innerText);
    alert("Results copied to clipboard!");
  }
}

// Utility Functions
function displayResults(containerId, data) {
  const container = document.getElementById(containerId);
  container.innerHTML = `<div class="result-card fade-in"><h3 class="result-header">AI Results</h3><pre class="result-json">${JSON.stringify(data, null, 2)}</pre><button onclick="copyResult()" class="copy-btn">üìã Copy Result</button></div>`;
}

function displayEDIResults(containerId, data) {
  const container = document.getElementById(containerId);
  let html = '<div class="result-card fade-in"><h3 class="result-header">üìä EDI Analysis Results</h3>';
  
  const validation = data.validation || {};
  if (validation.isValid) {
    html += '<div class="result-section success-card"><h4>‚úÖ Validation: PASSED</h4></div>';
  } else {
    html += '<div class="result-section error-card"><h4>‚ùå Validation: FAILED</h4></div>';
  }
  
  if (validation.errors && validation.errors.length > 0) {
    html += '<div class="result-section error-card"><h4>‚ùå Errors:</h4><ul>';
    validation.errors.forEach(err => html += `<li>${err}</li>`);
    html += '</ul></div>';
  }
  
  if (validation.warnings && validation.warnings.length > 0) {
    html += '<div class="result-section warning-card"><h4>‚ö†Ô∏è Warnings:</h4><ul>';
    validation.warnings.forEach(warn => html += `<li>${warn}</li>`);
    html += '</ul></div>';
  }
  
  if (data.summary) {
    html += `<div class="result-section"><h4>üìù Summary:</h4><p>${data.summary}</p></div>`;
  }
  
  if (validation.containersFound > 0) {
    html += `<div class="result-section"><h4>üì¶ Containers Found: ${validation.containersFound}</h4></div>`;
  }
  
  html += `<details class="result-section"><summary>View Full JSON</summary><pre class="result-json">${JSON.stringify(data, null, 2)}</pre></details>`;
  html += '<button onclick="copyResult()" class="copy-btn">üìã Copy Result</button></div>';
  
  container.innerHTML = html;
}

function displayResumeResults(containerId, data, type = "ats") {
  const container = document.getElementById(containerId);
  let html = '<div class="result-card fade-in"><h3 class="result-header">üìÑ Resume Analysis Results</h3>';
  
  if (type === "full") {
    const atsScore = data.atsScore || {};
    const overallScore = atsScore.overallScore || 0;
    html += `<div class="result-section success-card"><h4>üéØ Overall ATS Score: <span class="score-badge">${overallScore}/100</span></h4></div>`;
    
    if (atsScore.strengths && atsScore.strengths.length > 0) {
      html += '<div class="result-section suggestion-card"><h4>‚úÖ Strengths:</h4><ul>';
      atsScore.strengths.forEach(str => html += `<li>${str}</li>`);
      html += '</ul></div>';
    }
    
    if (atsScore.weaknesses && atsScore.weaknesses.length > 0) {
      html += '<div class="result-section error-card"><h4>‚ö†Ô∏è Weaknesses:</h4><ul>';
      atsScore.weaknesses.forEach(weak => html += `<li>${weak}</li>`);
      html += '</ul></div>';
    }
  } else {
    const overallScore = data.overallScore || 0;
    html += `<div class="result-section success-card"><h4>üéØ ATS Score: <span class="score-badge">${overallScore}/100</span></h4></div>`;
    
    if (data.strengths && data.strengths.length > 0) {
      html += '<div class="result-section suggestion-card"><h4>‚úÖ Strengths:</h4><ul>';
      data.strengths.forEach(str => html += `<li>${str}</li>`);
      html += '</ul></div>';
    }
  }
  
  html += `<details class="result-section"><summary>View Full JSON</summary><pre class="result-json">${JSON.stringify(data, null, 2)}</pre></details>`;
  html += '<button onclick="copyResult()" class="copy-btn">üìã Copy Result</button></div>';
  
  container.innerHTML = html;
}

function displayBusinessResults(containerId, data) {
  const container = document.getElementById(containerId);
  let html = '<div class="result-card fade-in"><h3 class="result-header">üìä Business Document Analysis</h3>';
  
  if (data.summary) {
    html += `<div class="result-section"><h4>üìù Summary:</h4><p>${data.summary}</p></div>`;
  }
  
  if (data.risks && data.risks.length > 0) {
    html += '<div class="result-section error-card"><h4>‚ö†Ô∏è Risks & Red Flags:</h4><ul>';
    data.risks.forEach(risk => html += `<li>${risk}</li>`);
    html += '</ul></div>';
  }
  
  html += `<details class="result-section"><summary>View Full JSON</summary><pre class="result-json">${JSON.stringify(data, null, 2)}</pre></details>`;
  html += '<button onclick="copyResult()" class="copy-btn">üìã Copy Result</button></div>';
  
  container.innerHTML = html;
}

function displayWebsiteResults(containerId, data) {
  const container = document.getElementById(containerId);
  let html = '<div class="result-card fade-in"><h3 class="result-header">üåê Website Analysis Results</h3>';
  
  const seoAnalysis = data.seoAnalysis || {};
  const seoScore = seoAnalysis.seoScore || 0;
  html += `<div class="result-section"><h4>SEO Score: <span class="score-badge">${seoScore}/100</span></h4></div>`;
  
  if (data.issues && data.issues.length > 0) {
    html += '<div class="result-section error-card"><h4>‚ùå Issues:</h4><ul>';
    data.issues.forEach(issue => html += `<li>${issue}</li>`);
    html += '</ul></div>';
  }
  
  if (data.recommendations && data.recommendations.length > 0) {
    html += '<div class="result-section suggestion-card"><h4>‚úÖ Recommendations:</h4><ul>';
    data.recommendations.forEach(rec => html += `<li>${rec}</li>`);
    html += '</ul></div>';
  }
  
  html += `<details class="result-section"><summary>View Full JSON</summary><pre class="result-json">${JSON.stringify(data, null, 2)}</pre></details>`;
  html += '<button onclick="copyResult()" class="copy-btn">üìã Copy Result</button></div>';
  
  container.innerHTML = html;
}

async function exportData() {
  const format = document.getElementById("outputFormat").value;
  const results = document.getElementById("businessResults").innerText;
  
  const res = await fetch(`/api/export/${format}`, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ data: JSON.parse(results || "{}") })
  });
  
  if (format === "json" || format === "excel") {
    const blob = await res.blob();
    const url = window.URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = `export.${format === "json" ? "json" : "csv"}`;
    a.click();
  } else {
    const data = await res.json();
    alert(`Export ready! Check console for ${format} format.`);
    console.log(data);
  }
}
</script>
{% endblock %}
